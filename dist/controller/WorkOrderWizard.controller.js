sap.ui.define(["sap/ui/core/mvc/Controller"],function(e){"use strict";return e.extend("com.capgemini.coe.irishRail_Worker.controller.WorkOrderWizard",{onInit:function(){this.WorkOrderModel=this.getOwnerComponent().getModel("WorkOrderModel");this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("RouteWorkOrderWizard").attachPatternMatched(this._onObjectMatched,this)},onhandleWizardCancel:function(e){this.oRouter.navTo("RouteDashboard")},_onObjectMatched:function(e){var t=e.getParameter("arguments").workorderNumber;this.WorkOrderModel.metadataLoaded().then(function(){var e=this.WorkOrderModel.createKey("WORKORDERS_DESC",{workorder:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){this.getView().bindElement({path:e,model:"WorkOrderModel"})},onPPECameraPress:function(e){var t=navigator.camera;t.getPicture(this.onSuccess.bind(this),this.onError.bind(this),{quality:75,cameraDirection:1,targetWidth:300,targetHeight:300,destinationType:t.DestinationType.FILE_URI})},onPPEBrowsePress:function(){var e=navigator.camera;e.getPicture(this.onSuccess.bind(this),this.onError.bind(this),{quality:75,targetWidth:300,targetHeight:300,destinationType:e.DestinationType.FILE_URI,sourceType:e.PictureSourceType.PHOTOLIBRARY})},onSuccess:function(e){this.oBusyIndicator.open();this.oBusyIndicator.setText("Validating PPE Check");var t=this;if(sap.ui.Device.system.desktop===true){this.callMLService(e)}else if(sap.ui.Device.system.phone===true){this.getImageData(e,function(e){t.callMLService(e)})}},onError:function(e){MessageBox.error("Oops! Unable to access camera")},getImageData:function(e,t){var r=new XMLHttpRequest;r.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)};e.readAsDataURL(r.response)};r.open("GET",e);r.responseType="blob";r.send()},callMLService:function(e){var t=this;var r=e.split(";");var o=r[0].split(":")[1];var a=r[1].split(",")[1];var i=this.b64toBlob(a,o);var n=new FormData;n.append("file",i);var s={async:true,crossDomain:true,url:"/PPE/upload",method:"POST",processData:false,contentType:false,mimeType:"multipart/form-data",data:n};var c=new Promise(function(e,r){$.ajax(s).success(function(e){this.oBusyIndicator.close();this.oRouter.navTo("RouteDashboard")}.bind(t)).error(function(e){debugger;MessageBox.error("Oops! Can't recognize the image. Try again.");this.oBusyIndicator.close()}.bind(t))})},b64toBlob:function(e,t,r){t=t||"";r=r||512;var o=atob(e);var a=[];for(var i=0;i<o.length;i+=r){var n=o.slice(i,i+r);var s=new Array(n.length);for(var c=0;c<n.length;c++){s[c]=n.charCodeAt(c)}var u=new Uint8Array(s);a.push(u)}var d=new Blob(a,{type:t});return d}})});