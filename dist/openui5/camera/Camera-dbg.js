sap.ui.define(["jquery.sap.global","sap/ui/core/Control"],function(e,t){"use strict";var i=t.extend("openui5.camera.Camera",{metadata:{properties:{width:{type:"string",defaultValue:"640"},height:{type:"string",defaultValue:"480"},videoWidth:{type:"string",defaultValue:"1280"},videoHeight:{type:"string",defaultValue:"960"}},events:{snapshot:{}}},init:function(){var e=this;this._displayingVideo=false},_onUserClickedVideo:function(){var e=parseInt(this.getVideoWidth(),10);var t=parseInt(this.getVideoHeight(),10);if(this._displayingVideo){var i=this._takePicture(e,t);this.fireSnapshot({image:i})}},_takePicture:function(e,t){var i=this._getCanvas();var a=this._getVideo();var n=null;var s=i.getContext("2d");if(e&&t){s.drawImage(a,0,0,e,t);n=i.toDataURL("image/jpeg")}return n},_getCanvas:function(){return e("canvas",e("#"+this.getId())).get(0)},_getVideo:function(){return e("video",e("#"+this.getId())).get(0)},stopCamera:function(){this._displayingVideo=false;if(this._stream){this._stream.getVideoTracks().forEach(function(e){e.stop()})}},onAfterRendering:function(){var t=this;var i=this._getVideo();if(i&&!i.onclick){i.onclick=function(){t._onUserClickedVideo()}}if(i&&!this._displayingVideo){navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:false}).then(function(e){t._stream=e;i.srcObject=e;i.play();t._displayingVideo=true}).catch(function(t){e.sap.log.error("Problems accessing the camera: "+t)})}}});return i});